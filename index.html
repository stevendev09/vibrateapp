<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibrar App</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6200ea">
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/service-worker.js").then(reg => {

        // Detecta SW nuevo en espera
        function handleSWUpdate(worker) {
          showUpdateBanner(() => {
            worker.postMessage({ type: "SKIP_WAITING" });
            location.reload();
          });
        }

        if (reg.waiting) {
          handleSWUpdate(reg.waiting);
        }

        reg.addEventListener("updatefound", () => {
          const newWorker = reg.installing;
          newWorker.addEventListener("statechange", () => {
            if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
              handleSWUpdate(newWorker);
            }
          });
        });

        // Hot reload al volver de segundo plano
        document.addEventListener("visibilitychange", () => {
          if (document.visibilityState === "visible" && reg.waiting) {
            handleSWUpdate(reg.waiting);
          }
        });
      });
    }

    // Funci√≥n para mostrar banner flotante
    function showUpdateBanner(onUpdate) {
      if (document.getElementById("update-banner")) return;

      const banner = document.createElement("div");
      banner.id = "update-banner";
      banner.style.position = "fixed";
      banner.style.bottom = "20px";
      banner.style.left = "50%";
      banner.style.transform = "translateX(-50%)";
      banner.style.background = "#222";
      banner.style.color = "#fff";
      banner.style.padding = "12px 24px";
      banner.style.borderRadius = "8px";
      banner.style.boxShadow = "0 2px 10px rgba(0,0,0,0.3)";
      banner.style.zIndex = "9999";
      banner.style.cursor = "pointer";
      banner.textContent = "Nueva versi√≥n disponible. Haz click para actualizar.";

      banner.addEventListener("click", onUpdate);

      document.body.appendChild(banner);
    }


  </script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background: #121212;
      color: white;
      font-family: sans-serif;
    }

    button {
      padding: 20px 40px;
      font-size: 22px;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      background: #6200ea;
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: 0.2s;
    }

    button:active {
      transform: scale(0.95);
      background: #3700b3;
    }
  </style>
</head>

<body>
  <button onclick="vibrate()">Vibrar</button>
  test test 30
  <script>
    function vibrate() {
      if ("vibrate" in navigator) {
        window.navigator.vibrate([300, 100, 300]);
      } else {
        // Fallback en iOS
        alert("üí• Vibraci√≥n simulada (iOS no la soporta)");
      }
    }
  </script>
</body>

</html>